<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Elisp Language Server | Jen-Chieh's Website</title>
<meta name=keywords content="Editor"><meta name=description content="
Repo link: https://github.com/jcs090218/ellsp
Iâ€™ve recently created a language server for Emacs Lisp. Itâ€™s interesting
since people donâ€™t think a language server for Emacs Lisp will provide
any value. The statement is correct, and so do I. Emacs Lisp is only used
within the Emacs editor, and Emacs itself is an Emacs Lisp interpreter.
Therefore, a language server for Emacs Lisp would hardly bring any benefits
to Emacs users.
But imagine you can code elisp (short for Emacs Lisp) outside of Emacs.
That sounds interesting, huh? ðŸ¤”"><meta name=author content="Jen-Chieh Shen"><link rel=canonical href=https://www.jcs-profile.com/posts/editor/elisp-ls/><link crossorigin=anonymous href=/assets/css/stylesheet.e54bf0f3dacc9e71f9e6b8bf4c1172ceab5ed40328aab328df982c4b2e650d2e.css integrity="sha256-5Uvw89rMnnH55ri/TBFyzqte1AMoqrMo35gsSy5lDS4=" rel="preload stylesheet" as=style><link rel=icon href=https://www.jcs-profile.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.jcs-profile.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.jcs-profile.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.jcs-profile.com/apple-touch-icon.png><link rel=mask-icon href=https://www.jcs-profile.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://www.jcs-profile.com/zh-tw/posts/editor/elisp-ls/><link rel=alternate hreflang=en href=https://www.jcs-profile.com/posts/editor/elisp-ls/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MLWCB75D6"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MLWCB75D6")}</script><meta property="og:url" content="https://www.jcs-profile.com/posts/editor/elisp-ls/"><meta property="og:site_name" content="Jen-Chieh's Website"><meta property="og:title" content="Elisp Language Server"><meta property="og:description" content=" Repo link: https://github.com/jcs090218/ellsp
Iâ€™ve recently created a language server for Emacs Lisp. Itâ€™s interesting since people donâ€™t think a language server for Emacs Lisp will provide any value. The statement is correct, and so do I. Emacs Lisp is only used within the Emacs editor, and Emacs itself is an Emacs Lisp interpreter. Therefore, a language server for Emacs Lisp would hardly bring any benefits to Emacs users.
But imagine you can code elisp (short for Emacs Lisp) outside of Emacs. That sounds interesting, huh? ðŸ¤”"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-19T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-19T00:00:00+00:00"><meta property="article:tag" content="Editor"><meta property="og:image" content="https://www.jcs-profile.com/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jcs-profile.com/cover.png"><meta name=twitter:title content="Elisp Language Server"><meta name=twitter:description content="
Repo link: https://github.com/jcs090218/ellsp
Iâ€™ve recently created a language server for Emacs Lisp. Itâ€™s interesting
since people donâ€™t think a language server for Emacs Lisp will provide
any value. The statement is correct, and so do I. Emacs Lisp is only used
within the Emacs editor, and Emacs itself is an Emacs Lisp interpreter.
Therefore, a language server for Emacs Lisp would hardly bring any benefits
to Emacs users.
But imagine you can code elisp (short for Emacs Lisp) outside of Emacs.
That sounds interesting, huh? ðŸ¤”"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.jcs-profile.com/posts/"},{"@type":"ListItem","position":2,"name":"Elisp Language Server","item":"https://www.jcs-profile.com/posts/editor/elisp-ls/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Elisp Language Server","name":"Elisp Language Server","description":" Repo link: https://github.com/jcs090218/ellsp\nIâ€™ve recently created a language server for Emacs Lisp. Itâ€™s interesting since people donâ€™t think a language server for Emacs Lisp will provide any value. The statement is correct, and so do I. Emacs Lisp is only used within the Emacs editor, and Emacs itself is an Emacs Lisp interpreter. Therefore, a language server for Emacs Lisp would hardly bring any benefits to Emacs users.\nBut imagine you can code elisp (short for Emacs Lisp) outside of Emacs. That sounds interesting, huh? ðŸ¤”\n","keywords":["Editor"],"articleBody":" Repo link: https://github.com/jcs090218/ellsp\nIâ€™ve recently created a language server for Emacs Lisp. Itâ€™s interesting since people donâ€™t think a language server for Emacs Lisp will provide any value. The statement is correct, and so do I. Emacs Lisp is only used within the Emacs editor, and Emacs itself is an Emacs Lisp interpreter. Therefore, a language server for Emacs Lisp would hardly bring any benefits to Emacs users.\nBut imagine you can code elisp (short for Emacs Lisp) outside of Emacs. That sounds interesting, huh? ðŸ¤”\nðŸ”° Start from scratch Okay, I didnâ€™t start entirely from scratch. I did use some libraries to help me set up things faster. Here are the important one:\nlsp-mode elsa - Iâ€™ve used some of their code What Iâ€™ve started from scratch is the stdio solution. Itâ€™s incredible how simple stdio can be within Emacsâ€™ batch mode.\nðŸ’« Issue 1: read-from-minibuffer and \\r/\\n The function read-from-minibuffer is one way to receive standard input within Emacsâ€™ batch mode. There is one issue with this method. It doesnâ€™t receive input until there is a \\r or \\n character at the end. Thatâ€™s annoying since the language server would never receive the complete packet. Here is what I would receive from the language client:\nContent-Length: 8203\\r\\n \\r\\n {json} And, this is what I hope to see:\nContent-Length: 8203\\r\\n \\r\\n {json}\\r\\n Iâ€™ve spent a couple of hours searching for a solution. Unfortunately, Iâ€™m not able to find one. Then, I decided to create a proxy stdio application using node.js and JavaScript that forwards an extra \\r\\n at the end of the packet.\nlet proc = startEmacs(); // Create process Emacs process.stdin.on('data', function(data) { let input = data.toString(); proc.stdin.write(input + '\\r\\n'); // Forward with an extra `\\r\\n`! }); Wola, now I am able to receive data from the language client! ðŸš€\nmethod: initialize \u003c\u003c {\"jsonrpc\":\"2.0\",\"id\":0,\"result\":{\"server-info\":{\"name\":\"ellsp\",\"version\":\"0.1.0\"},\"capabilities\":{\"hoverProvider\":true,\"textDocumentSync\":{\"openClose\":true,\"save\":true,\"change\":1},\"completionProvider\":{\"resolveProvider\":false},\"signatureHelpProvider\":{\"triggerCharacters\":[\" \"]}}}} ðŸ’« Issue 2: Specificationâ€¦ error? According to LSP Specification, we should send two \\r\\n between the Content-Length and the content itself (JSON body). However, for some reason, the language client never gets initializedâ€¦\nThe solution here is to just use \\n instead. (Donâ€™t ask me why; I have no idea.) ðŸ¤”\nmethod: initialized \u003c\u003c no response âšœ Conclusion I apologize; this post isnâ€™t about the implementation details. The implementation is quite simple. It only took me a couple of hours to implement it. If you are interested in the implementation, please check out the repository directly. The link is at the beginning of this page.\n","wordCount":"412","inLanguage":"en","image":"https://www.jcs-profile.com/cover.png","datePublished":"2023-11-19T00:00:00Z","dateModified":"2023-11-19T00:00:00Z","author":[{"@type":"Person","name":"Jen-Chieh Shen"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.jcs-profile.com/posts/editor/elisp-ls/"},"publisher":{"@type":"Organization","name":"Jen-Chieh's Website","logo":{"@type":"ImageObject","url":"https://www.jcs-profile.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.jcs-profile.com/ accesskey=h title="Jen-Chieh's Website (Alt + H)">Jen-Chieh's Website</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.jcs-profile.com/zh-tw/ title=Zh-Tw aria-label=Zh-Tw>Zh-Tw</a></li></ul></div></div><ul id=menu><li><a href=https://www.jcs-profile.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://www.jcs-profile.com/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://www.artstation.com/jcs090218 title=Art><span>Art</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.jcs-profile.com/storage/Resume.pdf title=Resume><span>Resume</span></a></li><li><a href=https://www.jcs-profile.com/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.jcs-profile.com/>Home</a>&nbsp;Â»&nbsp;<a href=https://www.jcs-profile.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Elisp Language Server</h1><div class=post-meta><span title='2023-11-19 00:00:00 +0000 UTC'>November 19, 2023</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>412 words</span>&nbsp;Â·&nbsp;<span>Jen-Chieh Shen</span>&nbsp;|&nbsp;<span>Translations:</span><ul class=i18n_list><li><a href=https://www.jcs-profile.com/zh-tw/posts/editor/elisp-ls/>Zh-Tw</a></li></ul></div></header><figure class=entry-cover><img loading=eager srcset='https://www.jcs-profile.com/posts/editor/elisp-ls/cover_hu_9db8b4184624d494.png 360w,https://www.jcs-profile.com/posts/editor/elisp-ls/cover_hu_d95fcf940c1ed59f.png 480w,https://www.jcs-profile.com/posts/editor/elisp-ls/cover_hu_8b816863978721df.png 720w,https://www.jcs-profile.com/posts/editor/elisp-ls/cover_hu_ff3b968b32d66e3.png 1080w,https://www.jcs-profile.com/posts/editor/elisp-ls/cover.png 1162w' src=https://www.jcs-profile.com/posts/editor/elisp-ls/cover.png sizes="(min-width: 768px) 720px, 100vw" width=1162 height=538 alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#-start-from-scratch aria-label="ðŸ”° Start from scratch">ðŸ”° Start from scratch</a><ul><li><a href=#-issue-1-read-from-minibuffer-and-rn aria-label="ðŸ’« Issue 1: read-from-minibuffer and \r/\n">ðŸ’« Issue 1: read-from-minibuffer and \r/\n</a></li><li><a href=#-issue-2-specification-error aria-label="ðŸ’« Issue 2: Specification&mldr; error?">ðŸ’« Issue 2: Specification&mldr; error?</a></li></ul></li><li><a href=#-conclusion aria-label="âšœ Conclusion">âšœ Conclusion</a></li></ul></div></details></div><div class=post-content><blockquote><p>Repo link: <a href=https://github.com/jcs090218/ellsp>https://github.com/jcs090218/ellsp</a></p></blockquote><p>Iâ€™ve recently created a language server for Emacs Lisp. Itâ€™s interesting
since people donâ€™t think a language server for Emacs Lisp will provide
any value. The statement is correct, and so do I. Emacs Lisp is only used
within the Emacs editor, and Emacs itself is an Emacs Lisp interpreter.
Therefore, a language server for Emacs Lisp would hardly bring any benefits
to Emacs users.</p><p>But imagine you can code elisp (short for Emacs Lisp) outside of Emacs.
That sounds interesting, huh? ðŸ¤”</p><h2 id=-start-from-scratch>ðŸ”° Start from scratch<a hidden class=anchor aria-hidden=true href=#-start-from-scratch>#</a></h2><p>Okay, I didn&rsquo;t start entirely from scratch. I did use some libraries to help
me set up things faster. Here are the important one:</p><ul><li><a href=https://github.com/emacs-lsp/lsp-mode>lsp-mode</a></li><li><a href=https://github.com/emacs-elsa/Elsa>elsa</a> - I&rsquo;ve used some of their code</li></ul><p>What I&rsquo;ve started from scratch is the <code>stdio</code> solution. It&rsquo;s incredible how
simple stdio can be within Emacs&rsquo; <code>batch</code> mode.</p><h3 id=-issue-1-read-from-minibuffer-and-rn>ðŸ’« Issue 1: <code>read-from-minibuffer</code> and <code>\r</code>/<code>\n</code><a hidden class=anchor aria-hidden=true href=#-issue-1-read-from-minibuffer-and-rn>#</a></h3><p>The function <code>read-from-minibuffer</code> is one way to receive standard input
within Emacs&rsquo; <code>batch</code> mode. There is one issue with this method. It doesn&rsquo;t
receive input until there is a <code>\r</code> or <code>\n</code> character at the end. That&rsquo;s
annoying since the language server would never receive the complete packet.
Here is what I would receive from the language client:</p><pre tabindex=0><code>Content-Length: 8203\r\n
\r\n
{json}
</code></pre><p>And, this is what I hope to see:</p><pre tabindex=0><code>Content-Length: 8203\r\n
\r\n
{json}\r\n
</code></pre><p>Iâ€™ve spent a couple of hours searching for a solution. Unfortunately,
Iâ€™m not able to find one. Then, I decided to create a proxy stdio
application using node.js and JavaScript that forwards an extra
<code>\r\n</code> at the end of the packet.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>proc</span> <span class=o>=</span> <span class=nx>startEmacs</span><span class=p>();</span>  <span class=c1>// Create process Emacs
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>stdin</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>input</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>proc</span><span class=p>.</span><span class=nx>stdin</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>input</span> <span class=o>+</span> <span class=s1>&#39;\r\n&#39;</span><span class=p>);</span>  <span class=c1>// Forward with an extra `\r\n`!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></div><p>Wola, now I am able to receive data from the language client! ðŸš€</p><pre tabindex=0><code>method: initialize
&lt;&lt; {&#34;jsonrpc&#34;:&#34;2.0&#34;,&#34;id&#34;:0,&#34;result&#34;:{&#34;server-info&#34;:{&#34;name&#34;:&#34;ellsp&#34;,&#34;version&#34;:&#34;0.1.0&#34;},&#34;capabilities&#34;:{&#34;hoverProvider&#34;:true,&#34;textDocumentSync&#34;:{&#34;openClose&#34;:true,&#34;save&#34;:true,&#34;change&#34;:1},&#34;completionProvider&#34;:{&#34;resolveProvider&#34;:false},&#34;signatureHelpProvider&#34;:{&#34;triggerCharacters&#34;:[&#34; &#34;]}}}}
</code></pre><h3 id=-issue-2-specification-error>ðŸ’« Issue 2: Specification&mldr; error?<a hidden class=anchor aria-hidden=true href=#-issue-2-specification-error>#</a></h3><p>According to <a href=https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/>LSP Specification</a>, we should send two <code>\r\n</code> between the <code>Content-Length</code> and
the content itself (JSON body). However, for some reason, the language client never gets initialized&mldr;</p><p>The solution here is to just use <code>\n</code> instead. (Don&rsquo;t ask me why; I have no idea.) ðŸ¤”</p><pre tabindex=0><code>method: initialized
&lt;&lt; no response
</code></pre><h2 id=-conclusion>âšœ Conclusion<a hidden class=anchor aria-hidden=true href=#-conclusion>#</a></h2><p>I apologize; this post isnâ€™t about the implementation details.
The implementation is quite simple. It only took me a couple of hours
to implement it. If you are interested in the implementation, please
check out the repository directly. The link is at the beginning of this page.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.jcs-profile.com/tags/editor/>Editor</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.jcs-profile.com/>Jen-Chieh's Website</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>